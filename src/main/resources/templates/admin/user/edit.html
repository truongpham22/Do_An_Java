<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="@{layout/layoutAdmin} :: header(Levent-Admin)">

</head>
<body class="sb-nav-fixed"  style="background-color: whitesmoke;">
<nav th:replace="@{layout/layoutAdmin} :: header_top"></nav>
<div id="layoutSidenav">
    <div th:replace="@{layout/layoutAdmin} :: menu"></div>
    <div id="layoutSidenav_content">
        <!--main-->
        <ol class="breadcrumb mb-4">
            <li class="breadcrumb-item"> <a class="nav-link" style="display: inline-block;" th:href="@{/admin/product}">Home</a> </li>
            <li class="breadcrumb-item"> <a class="nav-link" style="display: inline-block;" th:href="@{/authent/array}">Quản lý tài khoản</a> </li>
            <li class="breadcrumb-item active"> <a class="nav-link" style="display: inline-block;" >Chỉnh sửa người dùng</a> </li>

        </ol>
        <hr />
        <form id="update-user-form" th:object="${user}" class="row g-3 px-5 shadow mx-5" style="background-color: white;">
            <input hidden th:field="*{name}">
                <div class="col-md-6">
                    <label class="form-label" >Tên người dùng:</label>
                    <input class="form-control" th:field="*{name}" >
                </div>
                <div class="col-md-6">
                    <label class="form-label" >Tên tài khoản:</label>
                    <input class="form-control" th:field="*{username}" >
                </div>
                <div class="col-md-6">
                    <label class="form-label" >Email:</label>
                    <input class="form-control" th:field="*{email}" >
                </div>
                <div class="col-md-6">
                    <label class="form-label" >Số điện thoại:</label>
                    <input class="form-control" th:field="*{phoneNumber}" >
                </div>
                <div class="col-md-6">
                    <label class="form-label" >Role:</label>
                    <input type="hidden" name="userId" th:value="${user.id}"/>
                    <div th:each="role: ${roles}">
                        <label>
                            <input type="checkbox" name="permissions" th:value="${role.id}" th:text="${role.name}"
                                   th:checked="${#lists.contains(userRoles.![role.id], role.id)}"/>
                        </label>
                    </div>
                </div>

            <div class="col-12">
                <input  type="submit" class="btn btn-dark mb-3" value="Lưu thay đổi">
            </div>
        </form>
        <div id="message"></div>
        <!--main-->
        <footer th:replace="@{layout/layoutAdmin} :: footer"></footer>
    </div>
</div>
</body>
</html>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!--<script>
// Lấy tất cả các phần tử input có type là checkbox trong DOM
var checkboxes = document.querySelectorAll("input[type='checkbox']");

// Duyệt qua từng checkbox và đặt trạng thái checked tương ứng
checkboxes.forEach(function(checkbox) {
  var roleId = checkbox.value;
  if (userRoles.includes(roleId)) {
    checkbox.checked = true;
  } else {
    checkbox.checked = false;
  }
});
</script>-->
<script>
    // Lấy form và nút submit
const form = document.getElementById('update-user-form');
const submitBtn = form.querySelector('input[type="submit"]');

// Gán sự kiện submit cho form
form.addEventListener('submit', (event) => {
  event.preventDefault(); // Ngăn chặn form submit mặc định

  // Lấy dữ liệu từ form
  const formData = new FormData(form);

  // Gọi API bằng fetch
  fetch('/authent/' + formData.get('userId'), {
    method: 'PUT',
    body: formData
  })
  .then(response => {
    if (response.ok) {
      // Nếu cập nhật thành công, thực hiện hành động tiếp theo
      // Ví dụ: hiển thị thông báo thành công
      alert('Cập nhật thành công!');
    } else {
      // Nếu có lỗi xảy ra, hiển thị thông báo lỗi
              $('#message').html('<div class="alert alert-danger">Error editing product: ' + error + '</div>');

      alert('Có lỗi xảy ra. Vui lòng thử lại sau.');
    }
  })
  .catch(error => {
    // Nếu có lỗi xảy ra khi gọi API, hiển thị thông báo lỗi
    alert('Có lỗi xảy ra. Vui lòng thử lại sau.');
  });
});
</script>
